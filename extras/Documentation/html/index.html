<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>MyoIMUGestureController: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MyoIMUGestureController_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MyoIMUGestureController
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">This library provides gesture detection functionality using almost exclusively the IMU data of the Myo Armband.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MyoIMUGestureController Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;"><h1>Introduction</h1>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">This library provides gesture detection functionality using almost exclusively the IMU data of the Myo Armband. The gestures are based on arm rotation to work with persons where distinct muscle activity is hard to detect. Muscle activity is only used for starting/ending the recording of a gesture. Uses the MyoBridge Arduino Library (<a href="https://github.com/vroland/MyoBridge">https://github.com/vroland/MyoBridge</a>).</div><div style="width:1000px;
margin:0 auto;"><h1>Usage</h1>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;"><h2>Syncing</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">Although this library mostly evades using the muscle activity, it is still needed for the lock/unlock gesture. But every user and every armband position is different in terms of signal strength. That is why you have to sync before using gesture detection.</div><div style="width:1000px;
margin:0 auto;">Syncing starts with a long vibration, this should usually the first vibration that occurs after program startup. After that long vibration, perform a <em>strong</em> gesture with your hand. <b>But what is a strong gesture?</b> Generally, any gesture that involves movement against a force works. This could be a wrist flex, a fist or waving in any direction:</div><div style="width:1000px;
margin:0 auto;"><div class="image">
<img src="../images/gestures_small.png" />
</div>
</div><div style="width:1000px;
margin:0 auto;">Hold this gesture for a short time. A short vibration will indicate the end of this procedure. You can now lock or unlock the gesture detection with this gesture.</div><div style="width:1000px;
margin:0 auto;"><h2>Locking/ Unlocking</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">To indicate when you want to record a gesture, unlock the gesture detection first. Do this by performing the lock/unlock gesture used when syncing. In the example sketch, a LED will now indicate that the unlock was successful. Now you can start performing a gesture. When you are finished, perform the lock/unlock gesture again to finish your command. The library will now evaluate the gesture and give a notification, if a gesture was detected. In the example sketch, the recognized gesture is sent via the serial connection and can be read on a serial monitor.</div><div style="width:1000px;
margin:0 auto;"><h2>Available Gestures</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">There are generally four types of gestures available: Horizontal Movement, Vertical Movement, Circular Movement and Arm Rotation. Every type has two opposites:</div><div style="width:1000px;
margin:0 auto;"><table class="doxtable">
<tr>
<th>Gesture Type </th><th>Subtype 1 (e.g. enable) </th><th>Subtype 2 (e.g. disable)  </th></tr>
<tr>
<td>Horizontal </td><td>Straight to right </td><td>Straight to right </td></tr>
<tr>
<td>Vertical </td><td>Straight up </td><td>Straight down </td></tr>
<tr>
<td>Circular </td><td>Circle clockwise </td><td>Circle counterclockwise </td></tr>
<tr>
<td>Arm Rotation </td><td>Rotate stretched arm CW </td><td>Rotate stretched arm CCW </td></tr>
</table>
<p>These images show a demonstration of the gestures above:</div><div style="width:1000px;
margin:0 auto;"><table  border="0">
<tr>
<td>Horizontal: </td></tr>
<tr>
<td><div class="image">
<img src="../images/right.gif"  style="padding: 20px;width:66.66%;"/>
</div>
</td><td><div class="image">
<img src="../images/left.gif"  style="padding: 20px;"/>
</div>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Vertical: </td></tr>
<tr>
<td><div class="image">
<img src="../images/up.gif"  style="padding: 20px;"/>
</div>
</td><td><div class="image">
<img src="../images/down.gif"  style="padding: 20px;"/>
</div>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Circular: </td></tr>
<tr>
<td><div class="image">
<img src="../images/circle_cw.gif"  style="padding: 20px;"/>
</div>
</td><td><div class="image">
<img src="../images/circle_ccw.gif"  style="padding: 20px;"/>
</div>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Rotate Arm: </td></tr>
<tr>
<td><div class="image">
<img src="../images/rotate_cw.gif"  style="padding: 20px;"/>
</div>
</td><td><div class="image">
<img src="../images/rotate_ccw.gif"  style="padding: 20px;"/>
</div>
 </td></tr>
</table>
</div><div style="width:1000px;
margin:0 auto;"><h2>Using the Library for your Sketch</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">To use the library, all you have to do is calling the initialization function after your program has connected to Myo:</div><div style="width:1000px;
margin:0 auto;"><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{C++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;// This function is called when a gesture is recognized</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;void updateControls(GestureType gesture);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;// This function is called when a lock/unlock happens</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;void updateLockOutput(bool locked);</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;//connected</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;MyoIMUGestureController::begin(bridge, updateControls, updateLockOutput);</div>
</div><!-- fragment --></div><div style="width:1000px;
margin:0 auto;"><em>After that, it is not recommended to use the MyoBridge objects for anything other than simple reads or vibration commands!</em> (See how it works for details) You can now receive gesture data and lock/unlock events from the two callback functions, <code><a class="el" href="_myo_i_m_u_gesture_control_8ino.html#a1c7eb2899938bae9e23d0ab315326b7c" title="update the output after IMU handling. ">updateControls()</a></code> and <code><a class="el" href="_myo_i_m_u_gesture_control_8ino.html#a949f65abdb3f1a84a11a6d5fdf6b0537" title="update the output after lock change ">updateLockOutput()</a></code>. You can also have a look at the example sketch provided with this library. That's it!</div><div style="width:1000px;
margin:0 auto;"><h1>How it works</h1>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;"><h2>Usage of the MyoBridge Library</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">This library is built on top of the MyoBridge library. As it is a specific application, extensive use of the MyoBridge library outside of this library is not recommended. The initialization function of this library (<code>begin()</code>) performs the following actions with the MyoBridge object passed to it:</div><div style="width:1000px;
margin:0 auto;"><ul>
<li>activate IMU and EMG data, deactivate pose data</li>
<li>set its own internal callbacks for IMU and EMG data</li>
<li>disables sleep mode for Myo</li>
</ul>
</div><div style="width:1000px;
margin:0 auto;"><h2>How Gestures are Recorded</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;"><em>Constants regarding this section are defined in <a class="el" href="_myo_i_m_u_gesture_controller_8h.html" title="header file describing the library interface ">MyoIMUGestureController.h</a></em></div><div style="width:1000px;
margin:0 auto;">The library permanently reads the EMG inputs and caches them in a list of size <code>EMG_CACHE_SIZE</code> and calculates the sum of the absolute values of all EMG data in the cache. This procedure is used to avoid flickering of the lock function, because EMG values are very susceptible to noise. During syncing, the highest recorded value of this sum is saved. When the user performs the lock/unlock gesture after sync, and a threshold of <code>LOCK_TOGGLE_THRESHOLD * sync_sum</code> is reached, the lock status is toggled and the <code>on_lock_change</code> callback is called.</div><div style="width:1000px;
margin:0 auto;">Now that the library is unlocked, the rotation of the user's arm is tracked as value of two angles (horizontal rotation and vertical rotation) and saved in a buffer. As soon as the user locks again using the lock/unlock gesture, the data in this buffer, together with the lasst roll angle of the users arm are evaluated for gesture recognition. If the gesture buffer is full before the user locks again, all recorded data is discarded and the library re-locks, assuming the unlock has happened accidentaly.</div><div style="width:1000px;
margin:0 auto;"><h2>Gesture Evaluation</h2>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;"><em>Constants regarding this section are defined in <a class="el" href="gesture_analysis_8h.html" title="Header file describing gesture types. ">gestureAnalysis.h</a></em></div><div style="width:1000px;
margin:0 auto;">When the user has successfully finished a gesture by re-locking, the data stored in the gesture cache is evalated by the <code><a class="el" href="gesture_analysis_8cpp.html#a41ef582391bebf707eb397fb76c6edd8" title="Processes the cached gesture data to recognize gestures. ">processCacheData()</a></code> function.</div><div style="width:1000px;
margin:0 auto;">The tests for gestures go from more to less complex, so the test for circular movement is performed first:</div><div style="width:1000px;
margin:0 auto;"><h3>Circle Evaluation</h3>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">At the start, we assume our data really represents a more or less perfect circle:</div><div style="width:1000px;
margin:0 auto;"><div class="image">
<img src="../images/circle_points.png" />
</div>
</div><div style="width:1000px;
margin:0 auto;">The first thing to know should be the radius and the center point of the circle. To find them, we pick a number of representative (sample) points (<code>GESTURE_CIRCLE_SAMPLES</code>) to save the arduino some work. If we have enough points (at least the number of sample points), we find the greatest distance for every of these points to any other point of the circle. We also sum up all point coordinates to find the circle center by just calculating the average point coordinates.</div><div style="width:1000px;
margin:0 auto;">Because the greatest distance to another point of the circle is the diameter, it should be nearly the same for all our sample points. To test this, we calculate the average radius and determine the standard deviation of this radius to the distance of every point of the circle from the center. For a perfect circle, this deviation would be 0. We also want closed circles, so we determine the distance from start to end point of the data set.</div><div style="width:1000px;
margin:0 auto;">Of course, users can't draw perfect circles. That is why we need to add some tolerance, but also some restrictions to destinguish a circle from other gestures:</div><div style="width:1000px;
margin:0 auto;"><ul>
<li>Minimum diameter of <code>CIRCLE_MIN_DIAMETER</code>.</li>
<li>Maximum standard deviation from the circle radius of <code>CIRCLE_MAX_DEVIATION</code>.</li>
<li>Maximum distance of circle ends of <code>MAX_ENDS_DISCANCE</code>.</li>
</ul>
</div><div style="width:1000px;
margin:0 auto;">If our data matches these restrictions, we still have to decide if clockwise or counterclockwise. This is done by keeping track of the minimum and maximum X coordinates and the maximum Y coordinate and their respective point indices. The order of these indices tells us the orientation of the circle. If the data does not match a circle, the process continues to arm rotation evaluation.</div><div style="width:1000px;
margin:0 auto;"><h3>Arm Rotation Evaluation</h3>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">Again, we have to gather some statistical data. This time, we calculate the variance (sqared standard deviation) of the X and Y coordinates to their respective other axis. In other words: How far do points deviate from the X or Y axis? Because vertical movement is typically a little more limited than horizontal movment, or at least percieved as such, the deviation in Y-direction is multiplied with the <code>Y_DEVIATION_CORRECTION</code> factor.</div><div style="width:1000px;
margin:0 auto;">For a gesture to be recognized as arm rotation, the following conditions have to be met:</div><div style="width:1000px;
margin:0 auto;"><ul>
<li>X and Y variance smaller than ROTATION_MAX_VARIANCE</li>
<li>An absolute arm rotation angle of more than ROTATION_MIN_ANGLE</li>
</ul>
</div><div style="width:1000px;
margin:0 auto;">If no arm rotation movement is recognized, the process proceeds to straight movement evaluation.</div><div style="width:1000px;
margin:0 auto;"><h3>Straight Movement Evaluation</h3>
</div><div style="width:1000px;
margin:0 auto;"></div><div style="width:1000px;
margin:0 auto;">The straight movement evaluation uses two new parameters: the relation of X and Y deviation and the distance from the point (0, 0). They are used to test the straight movement conditions:</div><div style="width:1000px;
margin:0 auto;"><ul>
<li>Distance from (0, 0) greater than <code>STRAIGHT_MIN_DISTANCE</code></li>
<li>X deviation greater than Y deviation and relation of deviations greater than 1/(<code>STRAIGHT_MAX_RELATION</code>)? -&gt; Horizontal movement</li>
<li>Y deviation greater than X deviation and relation of deviations smaller than <code>STRAIGHT_MAX_RELATION</code>? -&gt; Vertical movement</li>
</ul>
</div><div style="width:1000px;
margin:0 auto;">If no gestures are recognized in this step, the gesture is not recognizable, and thus <code>ARM_UNKNOWN</code>. </div> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
